import"./DE3akDVi.js";import"./BsPQu0W_.js";import{m as L,q as l,e as v,f as u,s as A,c as k,S as D,b as o,E as s,g as E}from"./D8j6JjnZ.js";import{z as B,B as T,l as U,v as _,b as M,g as P,c as R,d as N}from"./DetAIFwH.js";import"./CzfjByzk.js";import"./CQx-Q2Z_.js";import"./CwuAAFsv.js";import"./DSGbj4hz.js";import"./DztEdZpe.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},r=new t.Error().stack;r&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[r]="e72f328c-ba38-470b-baf0-3db895db6749",t._sentryDebugIdIdentifier="sentry-dbid-e72f328c-ba38-470b-baf0-3db895db6749")}catch{}})();async function O(t,r){return B(r,()=>L(t,r))}function x(){T().finally(),setInterval(T,60*60*1e3)}const S=new Map;function z(t){t.forEach(({fn:e,uuid:a})=>{S.set(a,e)}),x(),chrome.tabs.onRemoved.addListener(e=>l(e)),chrome.tabs.onUpdated.addListener((e,a)=>{a.status==="loading"&&l(e)}),chrome.tabs.onActivated.addListener(e=>{v(e.tabId)});const r=new Map;chrome.runtime.onMessage.addListener((e,a,n)=>{var f,b,g,m,p;if(e.action==="requestAdapterBackgroundScriptAbort")return(f=r.get(e.signal))==null||f.abort(),l(e.signal),console.log("Abort request signal",e.signal),!1;if(e.action==="requestAdapterBackgroundScript"){e.config.signal&&r.set(e.config.signal,new AbortController);const C=[((b=a.tab)==null?void 0:b.id)||-1,e.config.signal].filter(U);return(async()=>{var h;try{const i=await O(C,{...e.config,responseType:"blob",signal:e.config.signal?(h=r.get(e.config.signal))==null?void 0:h.signal:void 0,responseTransformer:async c=>{if(["application/json","text/plain"].includes(c.type)&&e.config.responseTransformer){const y=S.get(e.config.responseTransformer);try{const w=JSON.parse(await c.text()),I=y?y(w):w;return await u(new Blob([JSON.stringify(I)],{type:c.type}))}catch{return await u(c)}}return await u(c)}});n({result:i})}catch(i){n({error:i instanceof Error?A(i):i})}})(),(g=a.tab)!=null&&g.active&&((m=a.tab)!=null&&m.id)&&v((p=a.tab)==null?void 0:p.id),!0}return!1})}k("reload",{type:D.Local});const d=t=>new URL(t,E.evirma.extensionLanding).toString();function J(){console.log("background script loaded"),chrome.runtime.setUninstallURL(d("uninstall")),chrome.runtime.onInstalled.addListener(async({reason:t})=>{switch(t){case chrome.runtime.OnInstalledReason.INSTALL:{const r=d("install");await chrome.tabs.create({url:r,active:!0});break}case chrome.runtime.OnInstalledReason.UPDATE:{const r=chrome.runtime.getManifest().version,e=d(`release_${r.replace(/\D+/g,"_")}`);if(!(await fetch(e,{method:"HEAD"})).ok)return;await chrome.tabs.create({url:e,active:!0});break}}}),chrome.storage.session.setAccessLevel({accessLevel:"TRUSTED_AND_UNTRUSTED_CONTEXTS"}),chrome.runtime.onMessage.addListener((t,r,e)=>{if(t.action===o.Ping&&t.source===s.ContentScript)return e({source:s.Background,action:o.Pong}),!0;if(t.action===o.OpenTab&&t.source===s.ContentScript){const{data:a}=t;return a?((async()=>{const n=await chrome.tabs.create({url:a.url,active:!1});e({source:s.Background,action:o.Pong,data:{tabId:n.id}})})(),!0):!1}if(t.action===o.CloseTab&&t.source===s.ContentScript){const{data:a}=t;return a&&(async()=>await chrome.tabs.remove(a.tabId))(),!1}return t.action===o.Broadcast&&t.source===s.ContentScript&&(async()=>{const a=await chrome.tabs.query({url:["https://*.wildberries.ru/*","https://wildberries.ru/*"]});await Promise.all(a.map(n=>{if(n.id)return chrome.tabs.sendMessage(n.id,t)}))})(),!1})}J();z([_.search,M.search,P.search,R.search,N.search]);
//# sourceMappingURL=e0DYs0Fv.js.map
