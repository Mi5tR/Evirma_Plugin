var B=Object.defineProperty;var D=(t,e,r)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var d=(t,e,r)=>D(t,typeof e!="symbol"?e+"":e,r);import{j,k as N}from"./DE3akDVi.js";import{s as W}from"./CQx-Q2Z_.js";import{r as T}from"./CwuAAFsv.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new t.Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="fe70e6db-38b4-4bf1-ae32-f0842d7ef466",t._sentryDebugIdIdentifier="sentry-dbid-fe70e6db-38b4-4bf1-ae32-f0842d7ef466")}catch{}})();const M={appName:"evirma",appNamePublic:"EVIRMA 2",release:"2.6.6",isDev:!1,locale:"ru-RU",wb:{name:"WILDBERRIES",marketPlaceBaseUrl:"https://www.wildberries.ru",sellerServiceBaseUrl:"https://seller.wildberries.ru",cmpServiceBaseUrl:"https://cmp.wildberries.ru",hostname:"wildberries.ru"},evirma:{site:"https://evirma.ru",bot:"https://t.me/EvirmaBot?start",supportGroup:"https://t.me/evirma_support_group",extensionLanding:"https://chrome.evirma.ru",channels:{maxProWB:{name:"@MaxProWB",url:"https://t.me/MaxProWB"}}},outRoute:{marketPlaceSearch:"/catalog/0/search.aspx?search=:search",marketPlaceProduct:"/catalog/:id/detail.aspx"}};class S extends Error{constructor(e,r){super(),this.name="StorageError",this.message=e||"Ошибка хранилища",this.cause=r,Object.setPrototypeOf(this,S.prototype)}}var R=(t=>(t.Local="local",t.Sync="sync",t.Session="session",t))(R||{}),v=(t=>(t.ExtensionPagesOnly="TRUSTED_CONTEXTS",t.ExtensionPagesAndContentScripts="TRUSTED_AND_UNTRUSTED_CONTEXTS",t))(v||{});function f(t){if(chrome.storage[t]===void 0)throw new S(`Check your storage permission in manifest.json: ${t} is not defined`)}function tt(t,e={}){const{type:r=R.Local}=e,a=JSON.stringify,i=JSON.parse;e.type===R.Session&&chrome.storage[r].setAccessLevel({accessLevel:v.ExtensionPagesAndContentScripts});const o=async()=>{f(r);const n=await chrome.storage[r].get([t]);return n[t]?i(n[t]):void 0},s=async n=>{f(r);try{await chrome.storage[r].set({[t]:a(n)})}catch(u){throw new S(`Can't set [${t}] value in ${r} storage`,u)}},l=async()=>{f(r),await chrome.storage[r].remove(t)},c=new Map;return{set:s,get:o,remove:l,addListener:n=>{if(f(r),!c.get(n)){const u=h=>{const{newValue:m}=h[t];n(m?i(m):void 0)};chrome.storage[r].onChanged.addListener(u),c.set(n,u)}},removeListener:n=>{f(r);const u=c.get(n);u&&chrome.storage[r].onChanged.removeListener(u)}}}function I(t,e){let r=[],a=0;const i=()=>{a--,r.length&&o()},o=()=>{a++;const n=r.shift();if(n){const{fn:u,args:h,reject:m,resolve:x}=n;u(...h).then(x).catch(m)}setTimeout(i,e.interval)},s=n=>(...u)=>new Promise((h,m)=>{r.push({resolve:h,reject:m,fn:t,args:u,tags:n,isPriority:!1}),a<e.limit&&o()}),l=(n,u)=>{const h=Array.isArray(u)?u:[u],m=Array.isArray(n)?n:[n];return j(h,m).length>0};return{next:s,purge:n=>{r=r.filter(({tags:u,reject:h})=>l(n,u)?(h(null),!1):!0)},pause:()=>{throw new Error("need implementation")},catchUp:n=>{r=r.map(u=>({...u,isPriority:l(n,u.tags)})).sort((u,h)=>Number(h.isPriority)-Number(u.isPriority))}}}class E extends Error{constructor(e){super(),this.name="ContextLostError",this.message="Context lost",this.cause=e,Object.setPrototypeOf(this,E.prototype)}}class L extends Error{constructor(r){super();d(this,"headers");d(this,"ok");d(this,"redirected");d(this,"status");d(this,"statusText");d(this,"type");d(this,"url");d(this,"data");this.name="RequestResponseError",this.message="Server returned response with error",this.headers=r.headers,this.ok=r.ok,this.redirected=r.redirected,this.status=r.status,this.statusText=r.statusText,this.type=r.type,this.url=r.url,this.data=r.data,Object.setPrototypeOf(this,L.prototype)}}class w extends Error{constructor(e){super(),this.name="RequestError",this.message=(e==null?void 0:e.message)||"Something went wrong",this.cause=e,Object.setPrototypeOf(this,w.prototype)}}class g extends w{constructor(e){super(e),this.name="RequestNetworkError",this.message=(e==null?void 0:e.message)||"Something went wrong with network",Object.setPrototypeOf(this,g.prototype)}}class C extends w{constructor(){super(),this.name="RequestSecurityError",this.message="Something went wrong with network",Object.setPrototypeOf(this,C.prototype)}}class O extends w{constructor(){super(),this.name="RequestTimeoutError",this.message="Request timed out",Object.setPrototypeOf(this,O.prototype)}}class k extends w{constructor(e){super(e),this.name="RequestAdapterError",this.message=(e==null?void 0:e.message)||"Something went wrong with request agent",Object.setPrototypeOf(this,k.prototype)}}class U extends k{constructor(e){super(e),this.name="RequestAdapterContextLostError",this.message=(e==null?void 0:e.message)||"Something went wrong with request agent",this.cause=e,Object.setPrototypeOf(this,U.prototype)}}async function q(t){let e;const r=[];t.signal&&r.push(t.signal),t.timeout&&r.push(AbortSignal.timeout(t.timeout));const a={method:t.method,referrer:t.referrer,cache:t.requestCache,credentials:t.credentials,signal:typeof AbortSignal.any=="function"?AbortSignal.any(r):t.signal,mode:t.mode||"cors"};try{let o;const s=new Headers(t.headers);t.data instanceof FormData||t.data instanceof ReadableStream?o=t.data:(o=JSON.stringify(t.data),s.has("Content-Type")||s.set("Content-Type","application/json")),a.headers=s,a.body=o,e=await fetch(t.url,a)}catch(o){if(o instanceof Error&&o.name==="TimeoutError")throw new O;if(o instanceof Error&&o.message==="Failed to fetch"&&a.mode==="cors"){let s;try{s=await fetch(t.url,{...a,mode:"no-cors"})}catch(l){throw new g(l)}if(s.type==="opaqueredirect"||s.type==="opaque")throw new C}throw new g(o)}const i=await T(e,t.responseType);return{headers:e.headers?Object.fromEntries(e.headers):{},ok:e.ok,redirected:e.redirected,status:e.status,statusText:e.statusText,type:e.type,url:e.url,data:typeof t.responseTransformer=="function"?await t.responseTransformer(i):i}}const et=t=>new Promise(e=>{const r=new FileReader;r.readAsDataURL(t),r.onloadend=()=>{const a=r.result;e(a)}}),$=async t=>(await fetch(t)).blob(),J=new Set(["это","как","под","так","и","в","над","к","до","не","на","но","за","то","с","ли","а","во","от","со","для","о","же","ну","вы","бы","что","кто","он","она"]),z=W.newStemmer("russian");function rt(t){return t.split(/\s+/gu).map(e=>{const r=e.toLowerCase().trim(),a=!J.has(r)&&r.length>2?z.stem(r):void 0;return{word:e,stem:a}})}function F(t){return!!t&&typeof t=="object"&&"name"in t&&"message"in t}function st(t){const e=[t],r=[],a=new Map;for(;e.length>0;){const i=e.pop(),o={name:i.name,message:i.message,stack:i.stack};a.set(i,o);const{cause:s}=i;if(s instanceof Error&&(e.push(s),r.push({parent:o,key:"cause"})),r.length>0&&!o.cause){const{parent:l,key:c}=r.shift();l[c]=o}if(e.length===0&&r.length===0)return o}throw new Error("Unexpected state in serialization logic.")}function V(t){const e=[],r=new Error(t.message);for(r.name=t.name,r.stack=t.stack,e.push({source:t,target:r});e.length>0;){const{source:a,target:i}=e.pop();if(a.cause){const o=new Error(a.cause.message);o.name=a.cause.name,o.stack=a.cause.stack,i.cause=o,e.push({source:a.cause,target:o})}}return r}const _=location.protocol!=="chrome-extension:"&&JSON.parse(localStorage.getItem("evirma-network-log")||"false"),H=(t,...e)=>{if(_){console.groupCollapsed(`%cRBAC ${t}`,`
        white-space: nowrap;
        padding-right: 6px;
        padding-top: 1px;
        border-radius: 2px;
        font-weight: bolder;
      `),console.log(new Date().toJSON());for(const r of e)r instanceof Error?console.error(r):console.log(r);console.groupEnd()}},P=new Map;async function at(t){return new Promise((e,r)=>{var o;const a=(s,...l)=>H(`${s} ${t.method} ${t.url}`,t,...l);if(a("REQ"),t.signal){const s=window.crypto.randomUUID();P.set(t.signal,s),t.signal.addEventListener("abort",()=>{chrome.runtime.sendMessage({action:"requestAdapterBackgroundScriptAbort",signal:s})})}const i={...t,responseTransformer:(o=t.responseTransformer)==null?void 0:o.uuid,signal:t.signal?P.get(t.signal):void 0,headers:t.headers?Object.fromEntries(new Headers(t.headers)):{}};try{chrome.runtime.sendMessage({action:"requestAdapterBackgroundScript",config:i},async s=>{if(t.signal&&P.delete(t.signal),s!=null&&s.result){const l=(...c)=>{var p;return a(((p=s.result)==null?void 0:p.status)||"RES",s.result,...c)};try{const c=typeof s.result.data=="string"?await $(s.result.data):null,p=new Response(c,{status:s.result.status,statusText:s.result.statusText,headers:s.result.headers}),b=await T(p,s.result.ok?t.responseType:void 0);return l(b),e({...s.result,data:b})}catch(c){return l(c.message,c),r(c)}}if(s!=null&&s.error)return a("ERR",s.error),F(s.error)?r(V(s.error)):r(new g(s.error));if(chrome.runtime.lastError)return a("chrome_error",chrome.runtime.lastError),r(new Error(`Runtime Last Error. ${chrome.runtime.lastError.message}`))})}catch(s){s instanceof Error&&s.message==="Extension context invalidated."&&r(new E(s)),r(s)}})}const y=new Map,ot=t=>{y.forEach(e=>{e.purge(t)})},nt=N(t=>{y.forEach(e=>{e.catchUp(t)})},300);async function it(t,{rate:e,...r}){if(!e)return q(r);const a=[r.method,r.basePath,typeof r.urlRaw=="string"?r.urlRaw:r.urlRaw.path].join("_");let i=y.get(a);return i||(console.log("Create requests queue",a),i=I(q,e),y.set(a,i)),i.next(t)(r)}var Q=(t=>(t[t.Catalog=4]="Catalog",t[t.Card=5]="Card",t[t.Search=6]="Search",t[t.Recom=7]="Recom",t[t.Auto=8]="Auto",t[t.SearchCatalog=9]="SearchCatalog",t))(Q||{}),X=(t=>(t[t.PopUp=0]="PopUp",t[t.Background=1]="Background",t[t.ContentScript=2]="ContentScript",t))(X||{}),G=(t=>(t[t.Ping=0]="Ping",t[t.Pong=1]="Pong",t[t.WbApiTokenModalShow=2]="WbApiTokenModalShow",t[t.WbMinusPhraseModalShow=3]="WbMinusPhraseModalShow",t[t.WbWarehouseAnalyzeModalShow=4]="WbWarehouseAnalyzeModalShow",t[t.SellerJobExecutionModalShow=5]="SellerJobExecutionModalShow",t[t.ExtensionUpdated=6]="ExtensionUpdated",t[t.Broadcast=7]="Broadcast",t[t.OpenTab=8]="OpenTab",t[t.CloseTab=9]="CloseTab",t))(G||{});export{Q as A,E as C,X as E,U as R,R as S,q as a,G as b,tt as c,C as d,nt as e,et as f,M as g,g as h,k as i,L as j,it as m,rt as p,ot as q,at as r,st as s};
//# sourceMappingURL=D8j6JjnZ.js.map
